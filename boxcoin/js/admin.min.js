"use strict";!function(){function t(t,e=-1){return BOXCoin.loading(t,e)}function e(t,e={},a=!1){return BOXCoin.ajax(t,e,a)}function a(t,e=!0){return BOXCoin.activate(t,e)}function c(t,e=!1){U.card(t,e)}function i(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function n(t,e=!1){U.error(t,e)}function o(t,e=-1){return t&&L(t).length()?(t=L(t).e[0],-1===e?L(t).is("checkbox")?t.checked:t.value.trim():(L(t).is("checkbox")?t.checked=e:t.value=e,void(L(t).is("textarea")&&b(t)))):""}function r(t){return L(t).find("input, select, textarea")}function s(){let t=window.location.href;if(t.includes("#")){let e=t.substr(t.indexOf("#"));if(e.length>1){let t=f.find(".bxc-nav "+e);if(t.length)return d(t),!0}}return!1}function d(c){if(!L(c).e.length)return;let i=f.find("main > div"),n=c.index();switch(m=L(i.e[n]),v=c.attr("id"),f.removeClass("bxc-area-transactions bxc-area-checkouts bxc-area-balances bxc-area-settings").addClass("bxc-area-"+v),a(i,!1),a(c.siblings(),!1),a(c),a(m),window.location.href.includes(v)||window.history.pushState("","","#"+v),v){case"transactions":t(m)||(t(m),$=0,g.find("tbody").html(""),N.print(()=>{t(i.e[n],!1)}));break;case"checkouts":m.hasClass("bxc-loading")&&e("get-checkouts",{},e=>{let a="";_=e;for(var c=0;c<e.length;c++)a+=T.row(e[c]);l(f.find("#bxc-table-checkouts tbody"),a),t(i.e[n],!1)});break;case"balances":U.balance(m);break;case"settings":m.hasClass("bxc-loading")&&e("get-settings",{},e=>{for(var a in e)o(r(f.find(`#${a}`)),e[a]);t(i.e[n],!1)})}}function l(t,e,a=!1){if(!e)return!t.html()&&t.html(`<p id="bxc-not-found">${i("There's nothing here yet.")}</p>`);t.find("#bxc-not-found").remove(),t.html((a?t.html():"")+e)}function u(){b(this)}function b(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"}var h,f,x,p,m,v,k,g,C,w=[!1,!1,!1,!1],y={P:"Pending",C:"Completed",R:"Refunded",X:"Underpayment"},$=0,B=!0,X=new Date,_=!1,R=window.innerWidth<769,O=!1,L=window._query,N={get:function(t,a=!1,c=!1,i=!1,n=!1){e("get-transactions",{pagination:$,search:a,status:c,cryptocurrency:i,date_range:n},e=>{$++,t(e)})},print:function(t,e=w[0],a=w[1],c=w[2],n=w[3]){this.get(e=>{let a="";B=e.length;for(var c=0;c<B;c++){let t=e[c],n=t.from?`<a href="${U.explorer(t.cryptocurrency,t.from)}" target="_blank" class="bxc-link">${t.from}</a>`:"",o=t.currency.toUpperCase()+" "+t.amount_fiat;a+=`<tr data-id="${t.id}" data-cryptocurrency="${t.cryptocurrency}" data-hash="${t.hash}" data-status="${t.status}"${t.billing?' data-invoice="true"':""}><td class="bcx-td-id">${t.id}</td><td class="bcx-td-time"><div class="bxc-title">${BOXCoin.beautifyTime(t.creation_time,!0)}</div></td><td class="bxc-td-title"><div class="bxc-title">${t.title}</div><div class="bxc-text">${t.description}</div></td><td>${n}</td><td>${t.to?`<a href="${U.explorer(t.cryptocurrency,t.to)}" target="_blank" class="bxc-link">${t.to}</a>`:""}</td><td class="bxc-td-status"><span class="bxc-status-${t.status}">${i(y[t.status])}</span></td><td class="bxc-td-amount"><div class="bxc-title">${t.amount?t.amount+" "+BOXCoin.baseCode(t.cryptocurrency.toUpperCase()):o}</div><div class="bxc-text">${t.amount?o:BOXCoin.baseCode(t.cryptocurrency)}</div></td><td><i class="bxc-transaction-menu-btn bxc-icon-menu"></i></td></tr>`}l(g.find("tbody"),a,!0),t&&t(e)},e,a,c,n)},query:function(e=!1){t(g)||(g.find("tbody").html(""),$=0,w[0]=L(f).find("#bxc-search-transactions").val().toLowerCase().trim(),w[1]=L(f).find("#bxc-filter-status li.bxc-active").attr("data-value"),w[2]=L(f).find("#bxc-filter-cryptocurrency li.bxc-active").attr("data-value"),w[3]=!!O&&O.getDates("yyyy-mm-dd"),this.print(()=>{e&&t(e,!1),t(g,!1)}))},download:function(t){e("download-transactions",{search:w[0],status:w[1],cryptocurrency:w[2],date_range:w[3]},e=>{t(e)})}},T={row:function(t){return`<tr data-checkout-id="${t.id}"><td><div class="bxc-title"><span>${t.id}</span><span>${t.title}</span></div></td><td><div class="bxc-text">${t.currency?t.currency:BXC_CURRENCY} ${t.price}</div></td></tr>`},embed:function(t=!1){let e=C?3:2;for(var a=0;a<e;a++){let e=m.find("#bxc-checkout-"+(0==a?"payment-link":1==a?"embed-code":"shortcode")).find("div, i");if(t){let c=0==a?`${BXC_URL}pay.php?checkout_id=${t}`:1==a?`<div data-boxcoin="${t}"></div>`:`[boxcoin id="${t}"]`;L(e.e[0]).html(c.replace(/</g,"&lt;")),L(e.e[1]).attr("data-text",window.btoa(c))}else L(e.e[0]).html(""),L(e.e[1]).attr("data-text","")}},get:function(t,e=!1){for(var a=0;a<_.length;a++)if(t==_[a].id)return e?(_.splice(a,1),!0):_[a];return!1}},U={card:function(t,e=!1){var a=f.find(".bxc-info-card");e?"error"==e?a.addClass("bxc-info-card-error"):a.addClass("bxc-info-card-info"):(a.removeClass("bxc-info-card-error bxc-info-card-warning bxc-info-card-info"),clearTimeout(x)),a.html(i(t)),x=setTimeout(()=>{a.html("")},5e3)},error:function(e,a=!1){window.scrollTo({top:0,behavior:"smooth"}),f.find(".bxc-info").html(e),a&&t(a,!1)},balance:function(a){if(!t(a)){let c=f.find("#bxc-table-balances tbody");c.html()||a.addClass("bxc-loading-first"),e("get-balances",{},e=>{let i="",n=e.balances;f.find("#bxc-balance-total").html(`${BXC_CURRENCY} ${e.total}`);for(var o in n)i+=`<tr data-cryptocurrency="${o}"><td><div class="bxc-flex"><img src="${BXC_URL}media/icon-${o}.svg" /> ${n[o].name}${BOXCoin.network(o)}</div></td><td><div class="bxc-balance bxc-title">${n[o].amount} ${BOXCoin.baseCode(o).toUpperCase()}</div><div class="bxc-text">${BXC_CURRENCY} ${n[o].fiat}</div></td></tr>`;i?c.html(i):c.parent().html('<p class="bxc-text">Add your addresses from the Settings area.</p>'),a.removeClass("bxc-loading-first"),t(a,!1)})}},explorer:function(t,e,a="address"){let c="",i="address"==a?"address":"ltc"==t?"transaction":"tx";switch(t){case"btc":c="https://www.blockchain.com/btc/{R}/{V}";break;case"link":case"bat":case"shib":case"usdc":case"usdt":case"eth":c="https://www.blockchain.com/eth/{R}/{V}";break;case"doge":c="https://dogechain.info/{R}/{V}";break;case"algo":c="https://algoexplorer.io/{R}/{V}";break;case"stripe":c="https://dashboard.stripe.com/customers/{V}";break;case"verifone":c="https://secure.2checkout.com/cpanel/order_info.php?refno={V}";break;case"busd":case"bnb":c="https://bscscan.com/{R}/{V}";break;case"ltc":c="https://blockchair.com/litecoin/{R}/{V}";break;case"bch":c="https://www.blockchain.com/bch/{R}/{V}"}return c.replace("{R}",i).replace("{V}",e)}};window.BXCTransactions=N,window.BXCCheckout=T,window.BXCAdmin=U,document.addEventListener("DOMContentLoaded",()=>{if(h=L(document.body),(f=h.find(".bxc-main")).e.length){if(p=f.find("main > div"),m=p.e[0],g=f.find("#bxc-table-transactions"),C="undefined"!=typeof BXC_WP,BOXCoin.cookie("BXC_LOGIN")&&!f.hasClass("bxc-installation")){v="transactions",s()||N.print(()=>{t(m,!1)}),localStorage.getItem("bxc-cron")!=X.getDate()&&(e("cron",{domain:BXC_URL}),localStorage.setItem("bxc-cron",X.getDate()));let a=document.getElementsByTagName("textarea");for(let t=0;t<a.length;t++)a[t].setAttribute("style","height:"+a[t].scrollHeight+"px;overflow-y:hidden;"),a[t].addEventListener("input",u,!1);U.balance(f.find('main > [data-area="balance"]'))}g.on("click","tr",function(t){if(["A","I","LI"].includes(t.target.nodeName))return;let e=L(this).attr("data-hash");if(e){let t=L(this).attr("data-cryptocurrency");window.open(U.explorer(t,e,"tx"))}}),f.on("click","#bxc-filters",function(){f.find(".bxc-nav-filters").toggleClass("bxc-active")}),f.on("click","#bxc-filter-date,#bxc-filter-date-2",function(){let t={maxNumberOfDates:2,maxDate:new Date,dateDelimiter:" - ",clearBtn:!0};O||(L.load(BXC_URL+"vendor/datepicker/datepicker.min.css",!1),L.load(BXC_URL+"vendor/datepicker/datepicker.min.js",!0,()=>{BXC_LANG?(t.language=BXC_LANG,L.load(`${BXC_URL}vendor/datepicker/locales/${BXC_LANG}.js`,!0,()=>{(O=new DateRangePicker(L(this).parent().e[0],t)).datepickers[0].show()})):(O=new DateRangePicker(L(this).parent().e[0],t)).datepickers[0].show()}))}),f.on("click","#bxc-filter-status li,#bxc-filter-cryptocurrency li, .datepicker-cell, .datepicker .clear-btn",function(){setTimeout(()=>{N.query()},100)}),f.on("click","#bxc-download-transitions",function(){t(this)||N.download(e=>{window.open(e),t(this,!1)})}),g.on("click",".bxc-transaction-menu-btn:not(.bxc-loading)",function(){let t=L(this).hasClass("bxc-active"),e=L(this.closest("tr")),c='<ul class="bxc-transaction-menu bxc-ul">',n=e.attr("data-status");if(a(g.find(".bxc-transaction-menu-btn"),!1),g.find(".bxc-transaction-menu").remove(),!t){a(this),e.attr("data-invoice")&&"C"==n&&(c+=`<li data-value="invoice">${i("Invoice")}</li>`),e.find(".bxc-td-title .bxc-text").html().length>30&&(c+=`<li data-value="description">${i("Description")}</li>`);for(var o in y)o!=n&&(c+=`<li data-value="${o}">${i("Mark as "+y[o].toLowerCase())}</li>`);L(this).parent().append(c+"</ul>")}}),g.on("click",".bxc-transaction-menu li",function(){let c=L(this.closest("tr")),n=c.find(".bxc-transaction-menu-btn");if(t(n))return;let o=L(this).attr("data-value"),r=c.attr("data-id");["C","P","R"].includes(o)&&e("update-transaction",{transaction_id:r,values:{status:o}},()=>{c.attr("data-status",o).find(".bxc-td-status span").attr("class","bxc-status-"+o).html(i(y[o])),t(n,!1)}),"invoice"==o&&e("invoice",{transaction_id:r},e=>{window.open(e),t(n,!1)}),"description"==o&&(c.find(".bxc-td-title .bxc-text").addClass("bxc-description-full"),t(n,!1)),c.find(".bxc-ul").remove(),a(n,!1)}),f.on("click","#bxc-create-checkout, #bxc-table-checkouts td",function(){if(f.addClass("bxc-area-create-checkout"),L(this).is("td")){let e=L(this).parent().attr("data-checkout-id"),a=T.get(e);m.attr("data-checkout-id",e);for(var t in a){o(r(m.find(`#bxc-checkout-${t}`)),a[t])}T.embed(e)}else r(m).e.forEach(t=>{o(t,"")}),m.find("#bxc-checkout-type select").val("I"),m.attr("data-checkout-id",""),T.embed()}),f.on("click","#bxc-checkouts-list",function(){f.removeClass("bxc-area-create-checkout"),m.attr("data-checkout-id","")}),f.on("click","#bxc-save-checkout",function(){if(t(this))return;let a=!1,i={},r=m.find(".bxc-input"),s=m.attr("data-checkout-id");f.find(".bxc-info").html(""),r.removeClass("bxc-error"),r.e.forEach(t=>{let e=L(t).attr("id"),c=L(t).find("input, select"),n=o(c);!n&&c.length()&&c.attr("required")&&(a=!0,L(t).addClass("bxc-error")),i[e.replace("bxc-checkout-","")]=n}),a?n("Fields in red are required.",this):(s&&(i.id=s),e("save-checkout",{checkout:i},e=>{t(this,!1),Number.isInteger(e)?(i.id=e,m.attr("data-checkout-id",e),m.find("#bxc-table-checkouts tbody").append(T.row(i)),T.embed(e),_.push(i),c("Checkout saved successfully")):!0===e?(T.get(s,!0),_.push(i),m.find(`tr[data-checkout-id="${s}"]`).replace(T.row(i)),c("Checkout saved successfully")):n(e,this.closest("form"))}))}),f.on("click","#bxc-delete-checkout",function(){if(t(this))return;let a=m.attr("data-checkout-id");e("delete-checkout",{checkout_id:a},()=>{t(this,!1),m.attr("data-checkout-id",""),m.find(`tr[data-checkout-id="${a}"]`).remove(),m.find("#bxc-checkouts-list").e[0].click(),c("Checkout deleted","error")})}),f.on("click","#bxc-save-settings",function(){if(t(this))return;let a={};f.find('[data-area="settings"]').find('.bxc-input[id]:not([data-type="multi-input"]),[data-type="multi-input"] [id]').e.forEach(t=>{a[L(t).attr("id")]=o(r(t))}),e("save-settings",{settings:JSON.stringify(a)},e=>{c(!0===e?"Settings saved":e,!0!==e&&"error"),t(this,!1)})}),f.on("click","#update-btn a",function(a){if(!t(this))return e("update",{domain:BXC_URL},e=>{!0===e?(c("Update completed. Reload in progress..."),setTimeout(()=>{location.reload()},500)):"latest-version-installed"==e?c("You have the latest version"):c(function(t){return(t=t.replace(/_/g," ").replace(/-/g," ")).charAt(0).toUpperCase()+t.slice(1)}(e),"error"),t(this,!1)}),a.preventDefault(),!1}),R&&f.on("click",".bxc-icon-menu",function(){let t=L(this).parent();a(t,!t.hasClass("bxc-active"))}),f.on("click","#bxc-submit-installation",function(){if(t(this))return;let a=!1,c={},i=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,""),o=f.find(".bxc-input");if(o.removeClass("bxc-error"),f.find(".bxc-info").html(""),o.e.forEach(t=>{let e=L(t).attr("id"),i=L(t).find("input"),n=i.val().trim();!n&&i.attr("required")&&(a=!0,L(t).addClass("bxc-error")),c[e]=n}),a){a="Username, password and the database details are required.";let t=c.password;return t&&(t.length<8?a="Minimum password length is 8 characters.":t!=c["password-check"]&&(a="The passwords do not match.")),void n(a,this)}i.includes("?")&&(i=i.substr(0,i.indexOf("?"))),c.url=i+"/",e("installation",{installation_data:JSON.stringify(c)},t=>{!0===t?location.reload():n(t,this)})}),f.on("click",".bxc-nav > div",function(){d(L(this))}),f.on("click","#bxc-submit-login",function(){t(this)||e("login",{username:f.find("#username input").val().trim(),password:f.find("#password input").val().trim()},e=>{e?(BOXCoin.cookie("BXC_LOGIN",e,365,"set"),location.reload()):(f.find(".bxc-info").html("Invalid username or password."),t(this,!1))})}),f.on("click","#bxc-logout",function(){BOXCoin.cookie("BXC_LOGIN",!1,!1,"delete"),location.reload()}),f.on("click","#bxc-card",function(){L(this).html("")}),f.on("input",".bxc-search-input",function(){BOXCoin.search(this,(t,e)=>{"transactions"==v&&N.query(e,t)})}),f.on("click","#bxc-table-balances tr",function(){let t=L(this).attr("data-cryptocurrency");window.open(U.explorer(t,BXC_ADDRESS[t]))}),f.on("click",".bxc-select",function(){let t=L(this).find("ul"),e=t.hasClass("bxc-active");a(t,!e),e||setTimeout(()=>{k=t.e[0]},300)}),f.on("click",".bxc-select li",function(){let t=L(this.closest(".bxc-select")),e=L(this).attr("data-value");var c=t.find(`[data-value="${e}"]`);a(t.find("li"),!1),t.find("p").attr("data-value",e).html(c.html()),a(c,!0),k=!1}),window.onscroll=function(){(document.documentElement||document.body.parentNode||document.body).scrollTop+window.innerHeight==L.documentHeight()&&B&&"transactions"==v&&(L(m).find("> .bxc-loading-global").e.length||(N.print(()=>{window.scrollTo(0,document.body.scrollHeight-800),L(m).find("> .bxc-loading-global").remove()}),L(m).append('<div class="bxc-loading-global bxc-loading"></div>')))},window.onpopstate=function(){s()},document.addEventListener("click",function(t){k&&!k.contains(t.target)&&(a(k,!1),k=!1)})}})}();