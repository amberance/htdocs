"use strict";!function(){function t(t,e=-1){return BOXCoin.loading(t,e)}function e(t,e={},a=!1){return BOXCoin.ajax(t,e,a)}function a(t,e=!0){return BOXCoin.activate(t,e)}function n(t,e=!1){T.card(t,e)}function c(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function i(t,e=!1){T.error(t,e)}function o(t,e=-1){return t&&O(t).length()?(t=O(t).e[0],-1===e?O(t).is("checkbox")?t.checked:t.value.trim():(O(t).is("checkbox")?t.checked=e:t.value=e,void(O(t).is("textarea")&&b(t)))):""}function r(t){return O(t).find("input, select, textarea")}function s(){let t=window.location.href;if(t.includes("#")){let e=t.substr(t.indexOf("#"));if(e.length>1){let t=f.find(".bxc-nav "+e);if(t.length)return d(t),!0}}return!1}function d(n){if(!O(n).e.length)return;let c=f.find("main > div"),i=n.index();switch(m=O(c.e[i]),v=n.attr("id"),f.removeClass("bxc-area-transactions bxc-area-checkouts bxc-area-balances bxc-area-settings").addClass("bxc-area-"+v),a(c,!1),a(n.siblings(),!1),a(n),a(m),window.location.href.includes(v)||window.history.pushState("","","#"+v),v){case"transactions":t(m)||(t(m),y=0,k.find("tbody").html(""),L.print(()=>{t(c.e[i],!1)}));break;case"checkouts":m.hasClass("bxc-loading")&&e("get-checkouts",{},e=>{let a="";B=e;for(var n=0;n<e.length;n++)a+=N.row(e[n]);l(f.find("#bxc-table-checkouts tbody"),a),t(c.e[i],!1)});break;case"balances":T.balance(m);break;case"settings":m.hasClass("bxc-loading")&&e("get-settings",{},e=>{for(var a in e)o(r(f.find(`#${a}`)),e[a]);t(c.e[i],!1)})}}function l(t,e,a=!1){if(!e)return!t.html()&&t.html(`<p id="bxc-not-found">${c("There's nothing here yet.")}</p>`);t.find("#bxc-not-found").remove(),t.html((a?t.html():"")+e)}function u(){b(this)}function b(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"}var h,f,p,x,m,v,k,g,C=[!1,!1,!1,!1],w={P:"Pending",C:"Completed",R:"Refunded",X:"Underpayment"},y=0,$=!0,_=new Date,B=!1,X=window.innerWidth<769,R=!1,O=window._query,L={get:function(t,a=!1,n=!1,c=!1,i=!1){e("get-transactions",{pagination:y,search:a,status:n,cryptocurrency:c,date_range:i},e=>{y++,t(e)})},print:function(t,e=C[0],a=C[1],n=C[2],i=C[3]){this.get(e=>{let a="";$=e.length;for(var n=0;n<$;n++){let t=e[n],i=t.from?`<a href="${T.explorer(t.cryptocurrency,t.from)}" target="_blank" class="bxc-link">${t.from}</a>`:"",o=t.currency.toUpperCase()+" "+t.amount_fiat;a+=`<tr data-id="${t.id}" data-cryptocurrency="${t.cryptocurrency}" data-hash="${t.hash}" data-status="${t.status}"${t.billing?' data-invoice="true"':""}><td class="bcx-td-id">${t.id}</td><td class="bcx-td-time"><div class="bxc-title">${BOXCoin.beautifyTime(t.creation_time,!0)}</div></td><td class="bxc-td-title"><div class="bxc-title">${t.title}</div><div class="bxc-text">${t.description}</div></td><td>${i}</td><td>${t.to?`<a href="${T.explorer(t.cryptocurrency,t.to)}" target="_blank" class="bxc-link">${t.to}</a>`:""}</td><td class="bxc-td-status"><span class="bxc-status-${t.status}">${c(w[t.status])}</span></td><td class="bxc-td-amount"><div class="bxc-title">${t.amount?t.amount+" "+BOXCoin.baseCode(t.cryptocurrency.toUpperCase()):o}</div><div class="bxc-text">${t.amount?o:BOXCoin.baseCode(t.cryptocurrency)}</div></td><td><i class="bxc-transaction-menu-btn bxc-icon-menu"></i></td></tr>`}l(k.find("tbody"),a,!0),t&&t(e)},e,a,n,i)},query:function(e=!1){t(k)||(k.find("tbody").html(""),y=0,C[0]=O(f).find("#bxc-search-transactions").val().toLowerCase().trim(),C[1]=O(f).find("#bxc-filter-status li.bxc-active").attr("data-value"),C[2]=O(f).find("#bxc-filter-cryptocurrency li.bxc-active").attr("data-value"),C[3]=!!R&&R.getDates("yyyy-mm-dd"),this.print(()=>{e&&t(e,!1),t(k,!1)}))},download:function(t){e("download-transactions",{search:C[0],status:C[1],cryptocurrency:C[2],date_range:C[3]},e=>{t(e)})}},N={row:function(t){return`<tr data-checkout-id="${t.id}"><td><div class="bxc-title"><span>${t.id}</span><span>${t.title}</span></div></td><td><div class="bxc-text">${t.currency?t.currency:BXC_CURRENCY} ${t.price}</div></td></tr>`},embed:function(t=!1){let e=g?3:2;for(var a=0;a<e;a++){let e=m.find("#bxc-checkout-"+(0==a?"payment-link":1==a?"embed-code":"shortcode")).find("div, i");if(t){let n=0==a?`${BXC_URL}pay.php?checkout_id=${t}`:1==a?`<div data-boxcoin="${t}"></div>`:`[boxcoin id="${t}"]`;O(e.e[0]).html(n.replace(/</g,"&lt;")),O(e.e[1]).attr("data-text",window.btoa(n))}else O(e.e[0]).html(""),O(e.e[1]).attr("data-text","")}},get:function(t,e=!1){for(var a=0;a<B.length;a++)if(t==B[a].id)return e?(B.splice(a,1),!0):B[a];return!1}},T={active_element:!1,card:function(t,e=!1){var a=f.find(".bxc-info-card");e?"error"==e?a.addClass("bxc-info-card-error"):a.addClass("bxc-info-card-info"):(a.removeClass("bxc-info-card-error bxc-info-card-warning bxc-info-card-info"),clearTimeout(p)),a.html(c(t)),p=setTimeout(()=>{a.html("")},5e3)},error:function(e,a=!1){window.scrollTo({top:0,behavior:"smooth"}),f.find(".bxc-info").html(e),a&&t(a,!1)},balance:function(a){if(!t(a)){let n=f.find("#bxc-table-balances tbody");if(!n.e.length)return;n.html()||a.addClass("bxc-loading-first"),e("get-balances",{},e=>{let c="",i=e.balances;f.find("#bxc-balance-total").html(`${BXC_CURRENCY} ${e.total}`);for(var o in i)c+=`<tr data-cryptocurrency="${o}"><td><div class="bxc-flex"><img src="${BXC_URL}media/icon-${o}.svg" /> ${i[o].name}${BOXCoin.network(o)}</div></td><td><div class="bxc-balance bxc-title">${i[o].amount} ${BOXCoin.baseCode(o).toUpperCase()}</div><div class="bxc-text">${BXC_CURRENCY} ${i[o].fiat}</div></td></tr>`;c?n.html(c):n.parent().html('<p class="bxc-text">Add your addresses from the Settings area.</p>'),a.removeClass("bxc-loading-first"),t(a,!1)})}},explorer:function(t,e,a="address"){let n="",c="address"==a?"address":"ltc"==t?"transaction":"tx";switch(t){case"btc":n="https://www.blockchain.com/btc/{R}/{V}";break;case"eth":n="https://www.blockchain.com/eth/{R}/{V}";break;case"doge":n="https://dogechain.info/{R}/{V}";break;case"link":case"bat":case"shib":case"usdc":case"usdt":n="https://etherscan.io/{R}/{V}#tokentxns";break;case"usdt_tron":n="https://tronscan.org/#/{R}/{V}";break;case"algo":n="https://algoexplorer.io/{R}/{V}";break;case"stripe":n="https://dashboard.stripe.com/customers/{V}";break;case"verifone":n="https://secure.2checkout.com/cpanel/order_info.php?refno={V}";break;case"busd":case"bnb":n="https://bscscan.com/{R}/{V}";break;case"ltc":n="https://blockchair.com/litecoin/{R}/{V}";break;case"bch":n="https://www.blockchain.com/bch/{R}/{V}"}return n.replace("{R}",c).replace("{V}",e)}};window.BXCTransactions=L,window.BXCCheckout=N,window.BXCAdmin=T,document.addEventListener("DOMContentLoaded",()=>{if(h=O(document.body),(f=h.find(".bxc-main")).e.length){if(x=f.find("main > div"),m=x.e[0],k=f.find("#bxc-table-transactions"),g="undefined"!=typeof BXC_WP,BOXCoin.cookie("BXC_LOGIN")&&!f.hasClass("bxc-installation")){v="transactions",s()||L.print(()=>{t(m,!1)}),localStorage.getItem("bxc-cron")!=_.getDate()&&(e("cron",{domain:BXC_URL}),localStorage.setItem("bxc-cron",_.getDate()));let a=document.getElementsByTagName("textarea");for(let t=0;t<a.length;t++)a[t].setAttribute("style","height:"+a[t].scrollHeight+"px;overflow-y:hidden;"),a[t].addEventListener("input",u,!1);T.balance(f.find('main > [data-area="balance"]'))}k.on("click","tr",function(t){if(["A","I","LI"].includes(t.target.nodeName))return;let e=O(this).attr("data-hash");if(e){let t=O(this).attr("data-cryptocurrency"),a=T.explorer(t,e,"tx");a&&window.open(a)}}),f.on("click","#bxc-filters",function(){f.find(".bxc-nav-filters").toggleClass("bxc-active")}),f.on("click","#bxc-filter-date,#bxc-filter-date-2",function(){let t={maxNumberOfDates:2,maxDate:new Date,dateDelimiter:" - ",clearBtn:!0};R||(O.load(BXC_URL+"vendor/datepicker/datepicker.min.css",!1),O.load(BXC_URL+"vendor/datepicker/datepicker.min.js",!0,()=>{BXC_LANG?(t.language=BXC_LANG,O.load(`${BXC_URL}vendor/datepicker/locales/${BXC_LANG}.js`,!0,()=>{(R=new DateRangePicker(O(this).parent().e[0],t)).datepickers[0].show()})):(R=new DateRangePicker(O(this).parent().e[0],t)).datepickers[0].show()}))}),f.on("click","#bxc-filter-status li,#bxc-filter-cryptocurrency li, .datepicker-cell, .datepicker .clear-btn",function(){setTimeout(()=>{L.query()},100)}),f.on("click","#bxc-download-transitions",function(){t(this)||L.download(e=>{window.open(e),t(this,!1)})}),k.on("click",".bxc-transaction-menu-btn:not(.bxc-loading)",function(){let t=O(this).hasClass("bxc-active"),e=O(this.closest("tr")),n='<ul class="bxc-transaction-menu bxc-ul">',i=e.attr("data-status");if(a(k.find(".bxc-transaction-menu-btn"),!1),k.find(".bxc-transaction-menu").remove(),!t){a(this),e.attr("data-invoice")&&"C"==i&&(n+=`<li data-value="invoice">${c("Invoice")}</li>`),e.find(".bxc-td-title .bxc-text").html().length>30&&(n+=`<li data-value="description">${c("Description")}</li>`);for(var o in w)o!=i&&(n+=`<li data-value="${o}">${c("Mark as "+w[o].toLowerCase())}</li>`);O(this).parent().append(n+"</ul>")}}),k.on("click",".bxc-transaction-menu li",function(){let n=O(this.closest("tr")),i=n.find(".bxc-transaction-menu-btn");if(t(i))return;let o=O(this).attr("data-value"),r=n.attr("data-id");["C","P","R"].includes(o)&&e("update-transaction",{transaction_id:r,values:{status:o}},()=>{n.attr("data-status",o).find(".bxc-td-status span").attr("class","bxc-status-"+o).html(c(w[o])),t(i,!1)}),"invoice"==o&&e("invoice",{transaction_id:r},e=>{window.open(e),t(i,!1)}),"description"==o&&(n.find(".bxc-td-title .bxc-text").addClass("bxc-description-full"),t(i,!1)),n.find(".bxc-ul").remove(),a(i,!1)}),f.on("click","#bxc-create-checkout, #bxc-table-checkouts td",function(){if(f.addClass("bxc-area-create-checkout"),O(this).is("td")){let e=O(this).parent().attr("data-checkout-id"),a=N.get(e);m.attr("data-checkout-id",e);for(var t in a){o(r(m.find(`#bxc-checkout-${t}`)),a[t])}N.embed(e)}else r(m).e.forEach(t=>{o(t,"")}),m.find("#bxc-checkout-type select").val("I"),m.attr("data-checkout-id",""),N.embed()}),f.on("click","#bxc-checkouts-list",function(){f.removeClass("bxc-area-create-checkout"),m.attr("data-checkout-id","")}),f.on("click","#bxc-save-checkout",function(){if(t(this))return;let a=!1,c={},r=m.find(".bxc-input"),s=m.attr("data-checkout-id");f.find(".bxc-info").html(""),r.removeClass("bxc-error"),r.e.forEach(t=>{let e=O(t).attr("id"),n=O(t).find("input, select"),i=o(n);!i&&n.length()&&n.attr("required")&&(a=!0,O(t).addClass("bxc-error")),c[e.replace("bxc-checkout-","")]=i}),a?i("Fields in red are required.",this):(s&&(c.id=s),e("save-checkout",{checkout:c},e=>{t(this,!1),Number.isInteger(e)?(c.id=e,m.attr("data-checkout-id",e),m.find("#bxc-table-checkouts tbody").append(N.row(c)),N.embed(e),B.push(c),n("Checkout saved successfully")):!0===e?(N.get(s,!0),B.push(c),m.find(`tr[data-checkout-id="${s}"]`).replace(N.row(c)),n("Checkout saved successfully")):i(e,this.closest("form"))}))}),f.on("click","#bxc-delete-checkout",function(){if(t(this))return;let a=m.attr("data-checkout-id");e("delete-checkout",{checkout_id:a},()=>{t(this,!1),m.attr("data-checkout-id",""),m.find(`tr[data-checkout-id="${a}"]`).remove(),m.find("#bxc-checkouts-list").e[0].click(),n("Checkout deleted","error")})}),f.on("click","#bxc-save-settings",function(){if(t(this))return;let a={};f.find('[data-area="settings"]').find('.bxc-input[id]:not([data-type="multi-input"]),[data-type="multi-input"] [id]').e.forEach(t=>{a[O(t).attr("id")]=o(r(t))}),e("save-settings",{settings:JSON.stringify(a)},e=>{n(!0===e?"Settings saved":e,!0!==e&&"error"),t(this,!1)})}),f.on("click","#update-btn a",function(a){if(!t(this))return e("update",{domain:BXC_URL},e=>{!0===e?(n("Update completed. Reload in progress..."),setTimeout(()=>{location.reload()},500)):"latest-version-installed"==e?n("You have the latest version"):n(function(t){return(t=t.replace(/_/g," ").replace(/-/g," ")).charAt(0).toUpperCase()+t.slice(1)}(e),"error"),t(this,!1)}),a.preventDefault(),!1}),X&&f.on("click",".bxc-icon-menu",function(){let t=O(this).parent();a(t,!t.hasClass("bxc-active"))}),f.on("click","#bxc-submit-installation",function(){if(t(this))return;let a=!1,n={},c=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,""),o=f.find(".bxc-input");if(o.removeClass("bxc-error"),f.find(".bxc-info").html(""),o.e.forEach(t=>{let e=O(t).attr("id"),c=O(t).find("input"),i=c.val().trim();!i&&c.attr("required")&&(a=!0,O(t).addClass("bxc-error")),n[e]=i}),a){a="Username, password and the database details are required.";let t=n.password;return t&&(t.length<8?a="Minimum password length is 8 characters.":t!=n["password-check"]&&(a="The passwords do not match.")),void i(a,this)}c.includes("?")&&(c=c.substr(0,c.indexOf("?"))),n.url=c+"/",e("installation",{installation_data:JSON.stringify(n)},t=>{!0===t?location.reload():i(t,this)})}),f.on("click",".bxc-nav > div",function(){d(O(this))}),f.on("click","#bxc-submit-login",function(){t(this)||e("login",{username:f.find("#username input").val().trim(),password:f.find("#password input").val().trim()},e=>{e?(BOXCoin.cookie("BXC_LOGIN",e,365,"set"),location.reload()):(f.find(".bxc-info").html("Invalid username or password."),t(this,!1))})}),f.on("click","#bxc-logout",function(){BOXCoin.cookie("BXC_LOGIN",!1,!1,"delete"),location.reload()}),f.on("click","#bxc-card",function(){O(this).html("")}),f.on("input",".bxc-search-input",function(){BOXCoin.search(this,(t,e)=>{"transactions"==v&&L.query(e,t)})}),f.on("click","#bxc-table-balances tr",function(){let t=O(this).attr("data-cryptocurrency"),e=T.explorer(t,BXC_ADDRESS[t]);e&&window.open(e)}),window.onscroll=function(){(document.documentElement||document.body.parentNode||document.body).scrollTop+window.innerHeight==O.documentHeight()&&$&&"transactions"==v&&(O(m).find("> .bxc-loading-global").e.length||(L.print(()=>{window.scrollTo(0,document.body.scrollHeight-800),O(m).find("> .bxc-loading-global").remove()}),O(m).append('<div class="bxc-loading-global bxc-loading"></div>')))},window.onpopstate=function(){s()},document.addEventListener("click",function(t){T.active_element&&!T.active_element.contains(t.target)&&(a(T.active_element,!1),T.active_element=!1)})}})}();